\RequirePackage{tikz, xcolor, textpos, calc}

\usetikzlibrary{shapes.geometric}


% Colour settings

\definecolor{TIB_red}{RGB}{194, 18, 34}
\definecolor{TIB_gray}{RGB}{85, 85, 85}

\setbeamercolor*{alerted text}{fg=TIB_red}
\setbeamercolor*{caption}{fg=TIB_gray}
\setbeamercolor*{caption name}{fg=TIB_gray}
\setbeamercolor*{description item}{fg=TIB_gray}
\setbeamercolor*{footline}{fg=TIB_gray}
\setbeamercolor*{frametitle}{fg=TIB_red}
\setbeamercolor*{item}{fg=TIB_gray}
\setbeamercolor*{normal text}{fg=TIB_gray}
\setbeamercolor*{section in toc}{fg=TIB_gray} % Why don't you work? Link colour must be adapted
\setbeamercolor*{subsection in toc}{fg=TIB_gray} % Why don't you work? Link colour must be adapted
\setbeamercolor*{separation line}{fg=TIB_gray}
\setbeamercolor*{structure}{fg=TIB_gray} % might be redundant to item list et al.
\setbeamercolor*{subitem}{fg=TIB_gray}
\setbeamercolor*{subsubitem}{fg=TIB_gray}
\setbeamercolor*{title}{fg=TIB_red}

% Font settings

\setbeamerfont*{author}{size=\normalsize, series=\bfseries}
\setbeamerfont*{frametitle}{size=\large, series=\bfseries}
\setbeamerfont*{subtitle}{size=\Large, series=\bfseries}
\setbeamerfont*{title}{size=\huge, series=\bfseries}

% Inner theme

\setbeamertemplate{itemize items}[square]
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{headline}{}
\setbeamertemplate{navigation symbols}{}

% Outer theme

\newlength{\TIBTitleBorder}
\setlength{\TIBTitleBorder}{0.5cm}

\newlength{\TIBLogoBorder}
\setlength{\TIBLogoBorder}{0.3cm}

\newlength{\TIBInnerSpace}
\setlength{\TIBInnerSpace}{0.6\paperwidth-\TIBTitleBorder}


\setbeamertemplate{title page}{
	\begin{tikzpicture}[remember picture,overlay]
		\node[at=(current page.north west),anchor=north west, xshift=1.0cm, yshift=-1.0cm] (overlay) {
			\includegraphics[height=0.78\paperheight,width=0.6\paperwidth]{tib/overlay}
		};
		\node[at=(overlay.north east),anchor=north east, xshift=-\TIBTitleBorder, yshift=-\TIBTitleBorder] (logo) {
			\includegraphics[width=0.2\paperwidth]{tib/logo.pdf}
		};
		\node[at=(overlay.north west),anchor=north west, xshift=\TIBTitleBorder, yshift=-\TIBTitleBorder] {
			\includegraphics[width=0.2\paperwidth]{tib/firm.pdf}
		};

		\node[at=(overlay.south west),anchor=south west, xshift=\TIBTitleBorder, yshift=\TIBTitleBorder](event){
			\begin{beamercolorbox}{headline}
				\usebeamerfont{headline}
			\end{beamercolorbox}
		};
		\node[at=(event.north west),anchor=south west](date){
			\begin{beamercolorbox}[wd=\TIBInnerSpace]{normal text}
				\usebeamerfont{normal text}\insertshortdate
			\end{beamercolorbox}
		};
		\node[at=(date.north west),anchor=south west](author){
			\begin{beamercolorbox}[wd=\TIBInnerSpace]{normal text}
				\usebeamerfont{normal text}\insertauthor
			\end{beamercolorbox}
		};
		\node[at=(author.north west),anchor=south west, yshift=\TIBTitleBorder](title){
			\begin{beamercolorbox}[wd=\TIBInnerSpace]{title}
				\usebeamerfont{title}\inserttitle
			\end{beamercolorbox}
		};

	\end{tikzpicture}
}

% Frame title
\defbeamertemplate*{frametitle}{TIB}
{
	\usebeamerfont*{frametitle}
	\usebeamercolor[fg]{frametitle}

	\begin{tikzpicture}[remember picture,overlay]
	\node[anchor=north west, xshift=\TIBTitleBorder, yshift=-\TIBTitleBorder] at (current page.north west)
	{
		\begin{beamercolorbox}[wd=8cm]{}
			\insertframetitle
		\end{beamercolorbox}
	};
	\end{tikzpicture}

	\begin{tikzpicture}[remember picture, overlay]
	\node[anchor=north east, xshift=-\TIBLogoBorder, yshift=-\TIBLogoBorder] at (current page.north east)
	{
		\includegraphics[width=0.2\linewidth, height=\paperheight, keepaspectratio]{tib/logo.pdf}
	};
	\end{tikzpicture}
}


% \setbeamertemplate{section in head/foot shaded}{\color{KlopeCedar}\insertsectionhead}

\setbeamertemplate{background}{
  \begin{tikzpicture}
	  \useasboundingbox (0,0) rectangle (\the\paperwidth,\the\paperheight);
  	\ifnum\thepage>1\relax%

  	\else % Title page
      \node[at=(current page.south east),anchor=south east,inner sep=0pt] {
        \includegraphics[height=\paperheight,width=\paperwidth]{tib/background}};
  	\fi
	\end{tikzpicture}
}


% \setbeamertemplate{frametitle}
% {%
%
%   \begin{tikzpicture}
% 		\node[at=(current page.south east),anchor=south east,inner sep=0pt] {
% 			\begin{beamercolorbox}[wd=12cm, left]{frametitle}
% 			\insertframetitle
% 			\end{beamercolorbox}
% 		};
% 	\end{tikzpicture}
% }


% \newenvironment{xplainframe}{%
% 	\bgroup%
% 	\setbeamercolor{frametitle}{fg=KlopeCedar}
% 	\setbeamertemplate{background}{%
% 		\begin{tikzpicture}%
% 		\useasboundingbox (0,0) rectangle (\the\paperwidth,\the\paperheight);%
% 		\fill[color=KlopeSand] rectangle (\the\paperwidth,\the\paperheight);%
% 		\end{tikzpicture}%
% 	}%
% 	\begin{frame}[plain]%
% }{	\end{frame}%
% 	\egroup%
% }
\newcommand{\sectionframe}{{
	\setbeamertemplate{background}{
		  \begin{tikzpicture}
		  \useasboundingbox (0,0) rectangle (\the\paperwidth,\the\paperheight);
		  \drawupperrectangles
		  \drawlowerrectangles
		  \end{tikzpicture}
	}
	\setbeamertemplate{headline}{}
	\frame{\sectionpage}
}}
